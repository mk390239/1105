<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>æ“ä½œå¯èƒ½ãªARãƒ¢ãƒ‡ãƒ«</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <a-scene 
        embedded 
        arjs 
        vr-mode-ui="enabled: false"
    >
        
        <!-- ãƒãƒ¼ã‚«ãƒ¼ -->
        <a-marker preset="hiro" id="marker">
            <a-entity 
                id="ar-model"
                gltf-model="4.glb"
                scale="0.01 0.01 0.01"
                rotation="-90 0 0"
            ></a-entity>
        </a-marker>
        
        <a-entity camera></a-entity>
    </a-scene>
    
    <!-- æ“ä½œèª¬æ˜ -->
    <div style="position: absolute; top: 20px; left: 0; right: 0; text-align: center; color: white; font-family: 'Hiragino Sans', sans-serif; font-size: 14px; text-shadow: 1px 1px 2px black; padding: 10px;">
        <div style="background: rgba(0,0,0,0.8); padding: 15px; border-radius: 10px; display: inline-block;">
            <div style="font-weight: bold; margin-bottom: 8px; font-size: 16px;">ğŸ® æ“ä½œèª¬æ˜</div>
            <div>ğŸ“± <b>ãƒ”ãƒ³ãƒ</b>: æ‹¡å¤§ãƒ»ç¸®å°</div>
            <div>ğŸ”„ <b>å›è»¢</b>: ãƒ¢ãƒ‡ãƒ«ã‚’å›è»¢</div>
            <div>ğŸ‘† <b>ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—</b>: ãƒªã‚»ãƒƒãƒˆ</div>
        </div>
    </div>

    <script>
        // ãƒ¢ãƒ‡ãƒ«æ“ä½œã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
        AFRAME.registerComponent('model-controls', {
            init: function() {
                this.model = this.el;
                this.initialScale = 0.01;
                this.currentScale = this.initialScale;
                this.isRotating = false;
                this.rotationSpeed = 2;
                
                this.setupGestures();
                this.addResetHandler();
            },
            
            setupGestures: function() {
                const scene = this.model.sceneEl;
                
                // ãƒ”ãƒ³ãƒã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ã§æ‹¡å¤§ç¸®å°
                scene.addEventListener('pinchstarted', (evt) => {
                    this.isScaling = true;
                });
                
                scene.addEventListener('pinchmoved', (evt) => {
                    if (this.isScaling) {
                        const scaleChange = evt.detail.spreadChange / 100;
                        this.currentScale = Math.max(0.005, Math.min(0.05, this.currentScale + scaleChange));
                        this.model.setAttribute('scale', {
                            x: this.currentScale,
                            y: this.currentScale,
                            z: this.currentScale
                        });
                    }
                });
                
                scene.addEventListener('pinchended', (evt) => {
                    this.isScaling = false;
                });
                
                // å›è»¢ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼
                let lastTouchX = 0;
                let isRotating = false;
                
                scene.addEventListener('touchstart', (evt) => {
                    if (evt.touches.length === 1) {
                        isRotating = true;
                        lastTouchX = evt.touches[0].clientX;
                    }
                });
                
                scene.addEventListener('touchmove', (evt) => {
                    if (isRotating && evt.touches.length === 1) {
                        const currentTouchX = evt.touches[0].clientX;
                        const deltaX = currentTouchX - lastTouchX;
                        
                        const currentRotation = this.model.getAttribute('rotation');
                        const newRotation = {
                            x: currentRotation.x,
                            y: currentRotation.y + deltaX * 0.5,
                            z: currentRotation.z
                        };
                        
                        this.model.setAttribute('rotation', newRotation);
                        lastTouchX = currentTouchX;
                    }
                });
                
                scene.addEventListener('touchend', (evt) => {
                    isRotating = false;
                });
            },
            
            addResetHandler: function() {
                // ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã§ãƒªã‚»ãƒƒãƒˆ
                let lastTap = 0;
                const scene = this.model.sceneEl;
                
                scene.addEventListener('touchstart', (evt) => {
                    const currentTime = new Date().getTime();
                    const tapLength = currentTime - lastTap;
                    
                    if (tapLength < 500 && tapLength > 0) {
                        // ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—æ¤œå‡º
                        this.resetModel();
                        evt.preventDefault();
                    }
                    lastTap = currentTime;
                });
                
                // PCç”¨ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯
                scene.addEventListener('dblclick', (evt) => {
                    this.resetModel();
                });
            },
            
            resetModel: function() {
                this.currentScale = this.initialScale;
                this.model.setAttribute('scale', {
                    x: this.initialScale,
                    y: this.initialScale, 
                    z: this.initialScale
                });
                this.model.setAttribute('rotation', {
                    x: -90,
                    y: 0,
                    z: 0
                });
                console.log('ğŸ”„ ãƒ¢ãƒ‡ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
            }
        });
        
        // ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼èªè­˜ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
        AFRAME.registerComponent('gesture-detector', {
            init: function() {
                this.scene = this.el;
                this.setupPinchGesture();
            },
            
            setupPinchGesture: function() {
                let initialDistance = 0;
                let currentDistance = 0;
                
                this.scene.addEventListener('touchstart', (evt) => {
                    if (evt.touches.length === 2) {
                        initialDistance = this.getTouchDistance(evt.touches);
                    }
                });
                
                this.scene.addEventListener('touchmove', (evt) => {
                    if (evt.touches.length === 2) {
                        currentDistance = this.getTouchDistance(evt.touches);
                        const spreadChange = currentDistance - initialDistance;
                        
                        this.scene.emit('pinchmoved', {
                            spreadChange: spreadChange
                        });
                    }
                });
                
                this.scene.addEventListener('touchend', (evt) => {
                    if (evt.touches.length < 2) {
                        this.scene.emit('pinchended');
                    }
                });
            },
            
            getTouchDistance: function(touches) {
                const dx = touches[0].clientX - touches[1].clientX;
                const dy = touches[0].clientY - touches[1].clientY;
                return Math.sqrt(dx * dx + dy * dy);
            }
        });
        
        // åˆæœŸåŒ–
        window.addEventListener('load', function() {
            // ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼æ¤œå‡ºã‚’æœ‰åŠ¹åŒ–
            document.querySelector('a-scene').setAttribute('gesture-detector', '');
            
            // ãƒ¢ãƒ‡ãƒ«æ“ä½œã‚’æœ‰åŠ¹åŒ–
            const model = document.querySelector('#ar-model');
            model.setAttribute('model-controls', '');
            
            console.log('ğŸ® æ“ä½œå¯èƒ½ARãƒ¢ãƒ‡ãƒ« æº–å‚™å®Œäº†');
            console.log('ğŸ“± æ“ä½œæ–¹æ³•:');
            console.log(' - ãƒ”ãƒ³ãƒ: æ‹¡å¤§ç¸®å°');
            console.log(' - 1æœ¬æŒ‡ãƒ‰ãƒ©ãƒƒã‚°: å›è»¢');
            console.log(' - ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—: ãƒªã‚»ãƒƒãƒˆ');
        });
        
        // ãƒãƒ¼ã‚«ãƒ¼æ¤œå‡ºæ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        document.querySelector('#marker').addEventListener('markerFound', function() {
            console.log('âœ… ãƒãƒ¼ã‚«ãƒ¼æ¤œå‡º - ãƒ¢ãƒ‡ãƒ«æ“ä½œå¯èƒ½');
        });
    </script>
    
    <style>
        body {
            font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', sans-serif;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
    </style>
</body>
</html>
