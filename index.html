<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>手机端固定位置WebAR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <a-scene 
        embedded 
        arjs 
        vr-mode-ui="enabled: false"
    >
        
        <!-- 标记 -->
        <a-marker preset="hiro" id="marker">
            <!-- 初始显示的模型 -->
            <a-entity 
                id="floating-model"
                gltf-model="4.glb"
                scale="0.05 0.05 0.05"  <!-- 调小尺寸 -->
                visible="true"
            ></a-entity>
        </a-marker>
        
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        let isModelFixed = false;
        let fixedModel = null;
        const scene = document.querySelector('a-scene');
        const marker = document.querySelector('#marker');
        const floatingModel = document.querySelector('#floating-model');
        
        // 标记被发现时
        marker.addEventListener('markerFound', function() {
            console.log('标记被发现');
            
            if (!isModelFixed) {
                console.log('固定模型到现实世界位置');
                
                // 隐藏浮动模型
                floatingModel.setAttribute('visible', 'false');
                
                // 创建新的固定模型（直接添加到场景，不在marker内）
                fixedModel = document.createElement('a-entity');
                fixedModel.setAttribute('gltf-model', '4.glb');
                fixedModel.setAttribute('scale', '0.05 0.05 0.05');  <!-- 小尺寸 -->
                fixedModel.setAttribute('visible', 'true');
                
                // 获取标记的当前位置
                const markerPosition = marker.object3D.position.clone();
                const markerRotation = marker.object3D.rotation.clone();
                
                // 设置固定模型的位置（世界坐标）
                fixedModel.object3D.position.copy(markerPosition);
                fixedModel.object3D.rotation.copy(markerRotation);
                
                // 添加到场景（关键：不在marker内部）
                scene.appendChild(fixedModel);
                
                isModelFixed = true;
                console.log('模型已固定在现实世界，移动手机不会跟随');
            }
        });
        
        // 点击屏幕重置（手机友好）
        scene.addEventListener('click', function() {
            if (isModelFixed) {
                if (fixedModel && fixedModel.parentNode) {
                    fixedModel.parentNode.removeChild(fixedModel);
                }
                floatingModel.setAttribute('visible', 'true');
                isModelFixed = false;
                console.log('已重置，重新扫描可固定新位置');
            }
        });
        
        // 控制台提示
        console.log('扫描Hiro标记后，模型将固定在现实世界位置');
        console.log('点击屏幕可以重置');
    </script>
</body>
</html>
