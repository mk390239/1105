<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>固定位置WebAR</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin: 0; overflow: hidden">
    <a-scene 
        embedded 
        arjs 
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true;"
    >
        
        <!-- 标记 -->
        <a-marker preset="hiro" id="marker" emitevents="true">
            <!-- 初始显示的模型 -->
            <a-entity 
                id="floating-model"
                gltf-model="4.glb"
                scale="0.5 0.5 0.5"
                visible="true"
            ></a-entity>
        </a-marker>
        
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        let isModelFixed = false;
        let fixedModel = null;
        
        const marker = document.querySelector('#marker');
        const floatingModel = document.querySelector('#floating-model');
        
        marker.addEventListener('markerFound', function() {
            if (!isModelFixed) {
                console.log('第一次识别标记，固定模型位置');
                
                // 隐藏浮动模型
                floatingModel.setAttribute('visible', 'false');
                
                // 创建新的固定模型（不在marker内部）
                fixedModel = document.createElement('a-entity');
                fixedModel.setAttribute('gltf-model', '4.glb');
                fixedModel.setAttribute('scale', '0.5 0.5 0.5');
                
                // 关键：复制标记的当前位置和旋转
                const markerPosition = marker.getAttribute('position');
                const markerRotation = marker.getAttribute('rotation');
                
                fixedModel.setAttribute('position', markerPosition);
                fixedModel.setAttribute('rotation', markerRotation);
                fixedModel.setAttribute('visible', 'true');
                
                // 添加到场景中，而不是标记中
                document.querySelector('a-scene').appendChild(fixedModel);
                
                isModelFixed = true;
                console.log('模型已固定在现实世界位置');
            }
        });
        
        // 重置功能：长按屏幕3秒
        let resetTimer = null;
        document.querySelector('a-scene').addEventListener('touchstart', function() {
            resetTimer = setTimeout(resetModel, 3000);
        });
        
        document.querySelector('a-scene').addEventListener('touchend', function() {
            clearTimeout(resetTimer);
        });
        
        function resetModel() {
            if (fixedModel) {
                fixedModel.parentNode.removeChild(fixedModel);
                fixedModel = null;
            }
            floatingModel.setAttribute('visible', 'true');
            isModelFixed = false;
            console.log('已重置，重新扫描标记可固定新位置');
        }
    </script>
</body>
</html>
