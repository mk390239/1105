<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>çœŸå®å›ºå®šä½ç½®WebAR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <a-scene 
        embedded 
        arjs 
        vr-mode-ui="enabled: false"
        xr-mode-ui="enabled: false"
    >
        
        <!-- æ ‡è®° - åªç”¨äºåˆå§‹å®šä½ -->
        <a-marker preset="hiro" id="marker" emitevents="true" smooth="true" smoothCount="10" smoothTolerance="0.01">
            <!-- åˆå§‹æ˜¾ç¤ºçš„æ¨¡å‹ï¼ˆå¾ˆå°ï¼‰ -->
            <a-entity 
                id="floating-model"
                gltf-model="4.glb"
                scale="0.01 0.01 0.01"  <!-- éå¸¸å°çš„å°ºå¯¸ -->
                visible="true"
            ></a-entity>
        </a-marker>
        
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        let isModelFixed = false;
        let worldModel = null;
        
        AFRAME.registerComponent('fixed-in-world', {
            init: function() {
                this.marker = document.querySelector('#marker');
                this.scene = this.el.sceneEl;
                
                this.marker.addEventListener('markerFound', () => {
                    if (!isModelFixed) {
                        this.fixModelInWorld();
                    }
                });
            },
            
            fixModelInWorld: function() {
                console.log('å°†æ¨¡å‹å›ºå®šåœ¨ç°å®ä¸–ç•Œä½ç½®');
                
                // éšè—æµ®åŠ¨æ¨¡å‹
                document.querySelector('#floating-model').setAttribute('visible', 'false');
                
                // è·å–æ ‡è®°çš„ä¸–ç•ŒçŸ©é˜µ
                const markerObj = this.marker.object3D;
                const worldMatrix = new THREE.Matrix4();
                markerObj.updateMatrixWorld(true);
                worldMatrix.copy(markerObj.matrixWorld);
                
                // åˆ›å»ºä¸–ç•Œåæ ‡ç³»ä¸­çš„æ¨¡å‹
                worldModel = document.createElement('a-entity');
                worldModel.setAttribute('gltf-model', '4.glb');
                worldModel.setAttribute('scale', '0.01 0.01 0.01');
                worldModel.setAttribute('visible', 'true');
                
                // åº”ç”¨ä¸–ç•Œå˜æ¢
                worldModel.object3D.applyMatrix4(worldMatrix);
                
                // æ·»åŠ åˆ°åœºæ™¯ï¼ˆä¸åœ¨markerå†…éƒ¨ï¼ï¼‰
                this.scene.appendChild(worldModel);
                
                isModelFixed = true;
                console.log('âœ… æ¨¡å‹å·²å›ºå®šåœ¨ç°å®ä¸–ç•Œï¼ç§»åŠ¨æ‰‹æœºä¸ä¼šè·Ÿéš');
            }
        });
        
        // ä¸ºåœºæ™¯æ·»åŠ å›ºå®šç»„ä»¶
        document.querySelector('a-scene').setAttribute('fixed-in-world', '');
        
        // åŒå‡»é‡ç½®
        document.querySelector('a-scene').addEventListener('dblclick', function() {
            if (worldModel && worldModel.parentNode) {
                worldModel.parentNode.removeChild(worldModel);
            }
            document.querySelector('#floating-model').setAttribute('visible', 'true');
            isModelFixed = false;
            console.log('ğŸ”„ å·²é‡ç½®ï¼Œé‡æ–°æ‰«ææ ‡è®°');
        });
        
        console.log('ğŸ“± æ‰«æHiroæ ‡è®°ï¼Œæ¨¡å‹å°†å›ºå®šåœ¨ç°å®ä¸–ç•Œä½ç½®');
        console.log('ğŸ’¡ åŒå‡»å±å¹•å¯ä»¥é‡ç½®');
    </script>
</body>
</html>
