<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>æ“ä½œå¯èƒ½ãªARãƒ¢ãƒ‡ãƒ«</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <a-scene 
        embedded 
        arjs 
        vr-mode-ui="enabled: false"
    >
        
        <!-- ãƒãƒ¼ã‚«ãƒ¼ -->
        <a-marker preset="hiro" id="marker">
            <a-entity 
                id="ar-model"
                gltf-model="4.glb"
                scale="0.01 0.01 0.01"
                rotation="-90 0 0"
            ></a-entity>
        </a-marker>
        
        <a-entity camera></a-entity>
    </a-scene>
    
    <!-- æ“ä½œèª¬æ˜ -->
    <div style="position: absolute; top: 20px; left: 0; right: 0; text-align: center; color: white; font-family: 'Hiragino Sans', sans-serif; font-size: 14px; text-shadow: 1px 1px 2px black; padding: 10px;">
        <div style="background: rgba(0,0,0,0.8); padding: 15px; border-radius: 10px; display: inline-block;">
            <div style="font-weight: bold; margin-bottom: 8px; font-size: 16px;">ğŸ® æ“ä½œèª¬æ˜</div>
            <div>ğŸ“± <b>ãƒ”ãƒ³ãƒ</b>: ãƒ¢ãƒ‡ãƒ«ã®æ‹¡å¤§ãƒ»ç¸®å°</div>
            <div>ğŸ”„ <b>ãƒ‰ãƒ©ãƒƒã‚°</b>: ãƒ¢ãƒ‡ãƒ«ã®å›è»¢</div>
            <div>ğŸ‘† <b>ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—</b>: ãƒªã‚»ãƒƒãƒˆ</div>
        </div>
    </div>

    <!-- æ“ä½œãƒœã‚¿ãƒ³ï¼ˆãƒ¢ãƒã‚¤ãƒ«ç”¨ï¼‰ -->
    <div style="position: absolute; bottom: 100px; right: 20px; display: flex; flex-direction: column; gap: 10px;">
        <button id="zoom-in" style="width: 60px; height: 60px; border-radius: 50%; border: none; background: rgba(0,0,0,0.7); color: white; font-size: 24px; font-weight: bold;">ï¼‹</button>
        <button id="zoom-out" style="width: 60px; height: 60px; border-radius: 50%; border: none; background: rgba(0,0,0,0.7); color: white; font-size: 24px; font-weight: bold;">ï¼</button>
        <button id="reset-model" style="width: 60px; height: 60px; border-radius: 50%; border: none; background: rgba(0,0,0,0.7); color: white; font-size: 20px;">â†º</button>
    </div>

    <script>
        // ãƒ¢ãƒ‡ãƒ«æ“ä½œã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
        AFRAME.registerComponent('model-controls', {
            init: function() {
                this.model = this.el;
                this.initialScale = 0.01;
                this.currentScale = this.initialScale;
                this.isRotating = false;
                this.lastTouchX = 0;
                
                this.setupEventListeners();
                this.setupUIButtons();
            },
            
            setupEventListeners: function() {
                const scene = this.model.sceneEl;
                const model = this.model;
                
                // ã‚¿ãƒƒãƒé–‹å§‹
                scene.addEventListener('touchstart', (evt) => {
                    // 1æœ¬æŒ‡ã§å›è»¢
                    if (evt.touches.length === 1) {
                        this.isRotating = true;
                        this.lastTouchX = evt.touches[0].clientX;
                    }
                    
                    // 2æœ¬æŒ‡ã§ã‚¹ã‚±ãƒ¼ãƒ«
                    if (evt.touches.length === 2) {
                        this.initialPinchDistance = this.getTouchDistance(evt.touches);
                        this.initialScale = this.currentScale;
                    }
                });
                
                // ã‚¿ãƒƒãƒç§»å‹•
                scene.addEventListener('touchmove', (evt) => {
                    evt.preventDefault();
                    
                    // å›è»¢å‡¦ç†
                    if (this.isRotating && evt.touches.length === 1) {
                        const currentTouchX = evt.touches[0].clientX;
                        const deltaX = currentTouchX - this.lastTouchX;
                        
                        const currentRotation = model.getAttribute('rotation');
                        const newRotation = {
                            x: currentRotation.x,
                            y: currentRotation.y + deltaX * 0.5,
                            z: currentRotation.z
                        };
                        
                        model.setAttribute('rotation', newRotation);
                        this.lastTouchX = currentTouchX;
                    }
                    
                    // ã‚¹ã‚±ãƒ¼ãƒ«å‡¦ç†
                    if (evt.touches.length === 2) {
                        const currentDistance = this.getTouchDistance(evt.touches);
                        const scaleRatio = currentDistance / this.initialPinchDistance;
                        
                        this.currentScale = Math.max(0.005, Math.min(0.1, this.initialScale * scaleRatio));
                        model.setAttribute('scale', {
                            x: this.currentScale,
                            y: this.currentScale,
                            z: this.currentScale
                        });
                    }
                });
                
                // ã‚¿ãƒƒãƒçµ‚äº†
                scene.addEventListener('touchend', (evt) => {
                    this.isRotating = false;
                });
                
                // ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã§ãƒªã‚»ãƒƒãƒˆ
                let lastTap = 0;
                scene.addEventListener('touchend', (evt) => {
                    const currentTime = new Date().getTime();
                    const tapLength = currentTime - lastTap;
                    
                    if (tapLength < 500 && tapLength > 0) {
                        this.resetModel();
                    }
                    lastTap = currentTime;
                });
                
                // PCç”¨ãƒã‚¦ã‚¹æ“ä½œ
                let isMouseDown = false;
                let lastMouseX = 0;
                
                scene.addEventListener('mousedown', (evt) => {
                    isMouseDown = true;
                    lastMouseX = evt.clientX;
                });
                
                scene.addEventListener('mousemove', (evt) => {
                    if (isMouseDown) {
                        const deltaX = evt.clientX - lastMouseX;
                        const currentRotation = model.getAttribute('rotation');
                        const newRotation = {
                            x: currentRotation.x,
                            y: currentRotation.y + deltaX * 0.5,
                            z: currentRotation.z
                        };
                        model.setAttribute('rotation', newRotation);
                        lastMouseX = evt.clientX;
                    }
                });
                
                scene.addEventListener('mouseup', () => {
                    isMouseDown = false;
                });
                
                // PCç”¨ãƒ›ã‚¤ãƒ¼ãƒ«ã‚ºãƒ¼ãƒ 
                scene.addEventListener('wheel', (evt) => {
                    evt.preventDefault();
                    const scaleChange = -evt.deltaY * 0.0001;
                    this.currentScale = Math.max(0.005, Math.min(0.1, this.currentScale + scaleChange));
                    model.setAttribute('scale', {
                        x: this.currentScale,
                        y: this.currentScale,
                        z: this.currentScale
                    });
                });
            },
            
            setupUIButtons: function() {
                // ã‚ºãƒ¼ãƒ ã‚¤ãƒ³ãƒœã‚¿ãƒ³
                document.getElementById('zoom-in').addEventListener('click', () => {
                    this.currentScale = Math.min(0.1, this.currentScale + 0.005);
                    this.model.setAttribute('scale', {
                        x: this.currentScale,
                        y: this.currentScale,
                        z: this.currentScale
                    });
                });
                
                // ã‚ºãƒ¼ãƒ ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³
                document.getElementById('zoom-out').addEventListener('click', () => {
                    this.currentScale = Math.max(0.005, this.currentScale - 0.005);
                    this.model.setAttribute('scale', {
                        x: this.currentScale,
                        y: this.currentScale,
                        z: this.currentScale
                    });
                });
                
                // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
                document.getElementById('reset-model').addEventListener('click', () => {
                    this.resetModel();
                });
            },
            
            getTouchDistance: function(touches) {
                const dx = touches[0].clientX - touches[1].clientX;
                const dy = touches[0].clientY - touches[1].clientY;
                return Math.sqrt(dx * dx + dy * dy);
            },
            
            resetModel: function() {
                this.currentScale = this.initialScale;
                this.model.setAttribute('scale', {
                    x: this.initialScale,
                    y: this.initialScale, 
                    z: this.initialScale
                });
                this.model.setAttribute('rotation', {
                    x: -90,
                    y: 0,
                    z: 0
                });
                console.log('ğŸ”„ ãƒ¢ãƒ‡ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
            }
        });
        
        // åˆæœŸåŒ–
        window.addEventListener('load', function() {
            const model = document.querySelector('#ar-model');
            model.setAttribute('model-controls', '');
            
            console.log('ğŸ® æ“ä½œå¯èƒ½ARãƒ¢ãƒ‡ãƒ« æº–å‚™å®Œäº†');
            console.log('ğŸ“± æ“ä½œæ–¹æ³•:');
            console.log(' - ãƒ”ãƒ³ãƒ: ãƒ¢ãƒ‡ãƒ«ã®æ‹¡å¤§ç¸®å°');
            console.log(' - 1æœ¬æŒ‡ãƒ‰ãƒ©ãƒƒã‚°: ãƒ¢ãƒ‡ãƒ«ã®å›è»¢');
            console.log(' - ãƒœã‚¿ãƒ³: æ‹¡å¤§/ç¸®å°/ãƒªã‚»ãƒƒãƒˆ');
        });
        
        document.querySelector('#marker').addEventListener('markerFound', function() {
            console.log('âœ… ãƒãƒ¼ã‚«ãƒ¼æ¤œå‡º - ãƒ¢ãƒ‡ãƒ«æ“ä½œå¯èƒ½');
        });
    </script>
    
    <style>
        body {
            font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', sans-serif;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        button {
            touch-action: manipulation;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        button:active {
            transform: scale(0.95);
            background: rgba(255,255,255,0.3) !important;
        }
    </style>
</body>
</html>
